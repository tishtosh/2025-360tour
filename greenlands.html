<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>360 tours</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gallery-plugin/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/virtual-tour-plugin/index.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/compass-plugin@5.12.1/index.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>


    <style>
        .ios-button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            color: #007aff;
            background-color: #ffffff;
            border: 1px solid #007aff;
            border-radius: 12px;
            text-align: center;
            text-decoration: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
            margin: 5px; /* Add margin to space the buttons */
        }
    
        .ios-button:hover {
            background-color: #f0f0f5;
        }
    
        .ios-button:active {
            background-color: #e0e0eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        </style>
        
</head>

<body>
   
    <!-- the viewer container must have a defined size -->
    <div id="viewer" style="width: 98vw; height: 85vh;"></div>
    
     <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    <script type="importmap">
        {
            "imports": {            
                "three" : "https://cdn.jsdelivr.net/npm/three/build/three.module.min.js",
                "@photo-sphere-viewer/core" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/core@5.12.0/index.module.min.js",
                "@photo-sphere-viewer/markers-plugin" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin@5.12.0/index.module.min.js",
                "@photo-sphere-viewer/gallery-plugin" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gallery-plugin@5.12.0/index.module.min.js",
                "@photo-sphere-viewer/virtual-tour-plugin" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/virtual-tour-plugin@5.12.0/index.module.min.js",
                "@photo-sphere-viewer/plan-plugin" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/plan-plugin@5.12.0/index.module.min.js",
                "@photo-sphere-viewer/compass-plugin" : "https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/compass-plugin@5.12.0/index.module.min.js"
            }
        }
    </script>


    <script type="module">
        // use  exiftool -XMP-GPano:PoseHeadingDegrees="290.0" 162430.jpg 
        
        import { Viewer } from '@photo-sphere-viewer/core';
        import { MarkersPlugin } from 'https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/markers-plugin@5.12.0/index.module.min.js';
        import { GalleryPlugin } from 'https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/gallery-plugin@5.12.0/index.module.min.js';
        import { VirtualTourPlugin } from 'https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/virtual-tour-plugin@5.12.0/index.module.min.js';
        import { CompassPlugin } from 'https://cdn.jsdelivr.net/npm/@photo-sphere-viewer/compass-plugin@5.12.0/index.module.min.js';
        //import { PlanPlugin } from '@photo-sphere-viewer/plan-plugin';
        
        const baseUrl = 'https://photo-sphere-viewer-data.netlify.app/assets/';
        //const caption = 'lighthouse';
        const pageCaption = 'Greenlands Drive';

        const getGPS = ( feetx, feety, feetz ) => {
            const feetToMeters = (feet) => feet * 0.3048;
            const inchesToMeters = (inches) => inches * 0.0254;
    
            // Base GPS position (longitude, latitude, altitude in meters)
            return [ 50.944905+ feetToMeters(feetx), -0.127910 + feetToMeters(feety), feetToMeters(feetz) ];
        };

        const getMarker = (id,offsetX, offsetY ) => {
            return {
                id: id,
                image: baseUrl + 'pictos/pin-red.png',
                tooltip: id,
                size:  { width: 16, height: 16 },
                anchor: 'bottom center',
                gps: getGPS( offsetX, offsetY, 0),
            };
        };

        const getNode3 = ( nodeid, image  ) => {
            return {
                id: nodeid,
                panorama: image,
                thumbnail: image,
                name: nodeid,
                caption: nodeid,
                links: [],
                gps:  getGPS( 0, 0, -4 ),
                sphereCorrection: { pan:0, tilt:0, roll:0 },
            };
        };

        const markerLight = {
            id: 'marker-1',
            image: baseUrl + 'pictos/pin-red.png',
            tooltip: 'light',
            size: { width: 16, height: 16 },
            anchor: 'bottom center',
            gps: [-80.155973, 25.666601, 29 + 3],
        };

        const floorSecond = [
            { id: "Hall-main", image: "images-second/101553.jpg" },
            { id: "Back-bedroom", image: "images-second/101419.jpg" },
            { id: "Back-bedroom-door", image: "images-second/101247.jpg" },
            { id: "Hall-back-bedroom", image: "images-second/101231.jpg" },
            { id: "Master-bedroom-front", image: "images-second/101020.jpg" },
            { id: "Master-bedroom-back", image: "images-second/100958.jpg" },
            { id: "Master-bedroom-hall", image: "images-second/100938.jpg" },
            { id: "Master-ensuite", image: "images-second/100852.jpg" },
            { id: "Master-hall", image: "images-second/100818.jpg" },
            { id: "Hall-master", image: "images-second/100745.jpg" },
            { id: "Hall-back", image: "images-second/100717.jpg" },
            { id: "Hall-front", image: "images-second/100653.jpg" },
            { id: "Hall-smalloffice", image: "images-second/100628.jpg" },
            { id: "Smalloffice", image: "images-second/100550.jpg" },
            { id: "Hall-smalloffice2", image: "images-second/100518.jpg" },
            { id: "Office-back", image: "images-second/100442.jpg" },
            { id: "Office-middle", image: "images-second/100419.jpg" },
            { id: "Office-front", image: "images-second/100350.jpg" },
            { id: "Hall-office", image: "images-second/100320.jpg" },
            { id: "Office-hall", image: "images-second/100243.jpg" },
            { id: "Hall-bathroom", image: "images-second/100137.jpg" },
            { id: "Bathroom", image: "images-second/100101.jpg" },
            { id: "Hall-middle", image: "images-second/095953.jpg" },
            { id: "Hall-topstairs", image: "images-second/095922.jpg" },
            { id: "Hall-midstairs", image: "images-second/095853.jpg" },
            { id: "Hall-topstairs2", image:" images-second/095737.jpg"},

            { id: "Front-bedroom-front", image: "images-second/101623.jpg" },
            { id: "Front-bedroom-back", image: "images-second/101643.jpg" }
        ];

        const floorSecond_hotspots = [
        { node: "Hall-midstairs", pitch: 0.17661486417346772, yaw: 0.7708615685594683, targetNode: "Hall-topstairs2" },
        
        { node: "Front-bedroom-front", pitch: -0.5425295772166323, yaw: 3.645874562828151, targetNode: "Hall-main" }, 
        { node: "Front-bedroom-front", pitch: -0.4008551329286614, yaw: 3.6068369350312226, targetNode: "Hall-smalloffice" },
        { node: "Front-bedroom-front", pitch: -0.2106864794412726, yaw: 3.5457877210828976, targetNode: "Hall-office" },
        { node: "Front-bedroom-front", pitch: -0.5169636211090105, yaw: 1.8296321909374966, targetNode: "Front-bedroom-back" },
        
        { node: "Front-bedroom-back", pitch: -0.5555174335451896, yaw: 4.58987824209615, targetNode: "Front-bedroom-front" },
        { node: "Front-bedroom-back", pitch: -0.26263724439192604, yaw: 3.887932032496394, targetNode: "Hall-topstairs2" }, 
        

        { node: "Hall-main", pitch: -0.3156840891909827, yaw: 4.694169138186291, targetNode: "Hall-back" },
        { node: "Hall-main", pitch: -0.26225265703912215, yaw: 6.16857884133013, targetNode: "Bathroom" },
        { node: "Hall-main", pitch: -0.8245645555879251, yaw: 6.084123699199449, targetNode: "Hall-smalloffice" },
        { node: "Hall-main", pitch: -0.3662494504226277, yaw: 6.159022872335235, targetNode: "Hall-office"},
        { node: "Hall-main", pitch: -0.8117589992474574, yaw: 0.7403071986331512, targetNode: "Hall-topstairs2" },
        { node: "Hall-main", pitch: -0.5167529001988278, yaw: 3.245747949064119, targetNode: "Front-bedroom-front" },

        { node: "Back-bedroom-door", pitch: -0.39059369542185385, yaw: 3.2510371768111077, targetNode: "Back-bedroom" },

        { node: "Back-bedroom", pitch: -0.32343245758253514, yaw: 6.125105247757037, targetNode: "Hall-back-bedroom" },

        { node: "Hall-back-bedroom", pitch: -0.2592449227374627, yaw: 2.817875164411757, targetNode: "Back-bedroom" },
        { node: "Hall-back-bedroom", pitch: -1.002785236443371, yaw: 3.0643437628574057, targetNode: "Back-bedroom-door" },
        { node: "Hall-back-bedroom", pitch: -0.5374751340341484, yaw: 4.766159375322387, targetNode: "Hall-back" },
        { node: "Hall-back-bedroom", pitch: -0.3945308240270631, yaw: 1.5184477546905522, targetNode: "Hall-master" },

        { node: "Hall-master", pitch: -0.4233402238810857, yaw: 6.140955738278213, targetNode: "Master-bedroom-back" }, 
        { node: "Master-hall", pitch: -0.4751802914366561, yaw: 1.449773466791425, targetNode: "Master-bedroom-back" },
        { node: "Master-hall", pitch: -0.1716124049638994, yaw: 0.5449294423709292, targetNode: "Master-bedroom-front" },
        
        { node: "Hall-topstairs2", pitch: -0.9115759740344411, yaw: 4.84998613157256, targetNode: "Hall-midstairs"  },
        { node: "Hall-topstairs2", pitch: -0.743140234889601, yaw: 3.5045008268213635, targetNode: "Hall-office" }, 
        { node: "Hall-topstairs2", pitch: -0.36529297923999615, yaw: 4.30705484569281, targetNode: "Hall-smalloffice" }, 
        { node: "Hall-topstairs2", pitch: -0.2530250349156322, yaw: 3.0508972830819214, targetNode: "Hall-back" },
        { node: "Hall-topstairs2", pitch: -0.7776161541419602, yaw: 2.52358673630309, targetNode: "Hall-main" },

        { node: "Hall-office", pitch: -0.6559013186191915, yaw: 2.0631286508636144, targetNode: "Bathroom" },
        { node: "Hall-office", pitch: -0.5187402302150823, yaw: 5.233919759293447, targetNode: "Hall-smalloffice" }, 
        { node: "Hall-office", pitch: -0.3462067583222077, yaw: 5.209138252404573, targetNode:  "Hall-main" },

        { node: "Hall-smalloffice", pitch: -0.2719174110035911, yaw: 2.8582203485500526, targetNode: "Bathroom" }, 
        { node: "Hall-smalloffice", pitch: -0.47901039920708843, yaw: 2.79903026224444, targetNode: "Hall-office" },
        { node: "Hall-smalloffice", pitch: -0.9492044936389581, yaw: 5.0421256798170635, targetNode: "Hall-topstairs2" },
        { node: "Hall-smalloffice", pitch: -0.875319328229486, yaw: 6.276152714403754, targetNode: "Hall-main" },
        { node: "Hall-smalloffice", pitch: -0.5101116066247768, yaw: 1.6703015886298334, targetNode: "Smalloffice" },
        
        { node: "Smalloffice", pitch: -0.35997212172233195, yaw: 1.6998845117405779, targetNode:  "Hall-topstairs2" },

        { node: "Office-hall", pitch: -0.9959521724059925, yaw: 0.2520577726367306, targetNode: "Office-front" }, 
        { node: "Office-hall", pitch: -0.9506273426628473, yaw: 3.230227641031322, targetNode: "Hall-office" },
        { node: "Office-hall", pitch: -0.39997552539611414, yaw: 0.5884617671832426, targetNode: "Office-back" },
        
        { node: "Office-front", pitch: -0.561206970040816, yaw: 3.22650374698193, targetNode: "Hall-office" },
        
        { node: "Hall-office", pitch: -0.6165877137559073, yaw: 0.5328655621483582, targetNode: "Office-front" },
        { node: "Hall-office", pitch: -1.0857402920484946, yaw: 0.6730613127044113, targetNode: "Office-hall" },
        
        { node: "Office-middle", pitch: -0.5940125976677324, yaw: 3.3694612001994795, targetNode: "Office-front" }, 
        { node: "Office-middle", pitch: -0.42030822191938455, yaw: 3.0371206737739933, targetNode: "Office-hall" },
        { node: "Office-middle", pitch: -0.7713912539509966, yaw: 4.953710550447017, targetNode: "Office-back" },
   
        { node: "Office-front", pitch: -0.7348174675480723, yaw: 0.8904079237467181, targetNode: "Office-middle" },
        { node: "Office-front", pitch: -0.5425016393106561, yaw: 0.37385208844508694, targetNode: "Office-back" },

        { node: "Office-back", pitch: -0.9476351624616632, yaw: 3.259599493251097, targetNode: "Office-middle" },
        { node: "Office-back", pitch: -0.4192615995667581, yaw: 3.9458688170139364, targetNode: "Office-hall" },
        { node: "Office-back", pitch: -0.2923504116198852, yaw: 3.9051508891866042, targetNode:  "Hall-office"},

        { node: "Bathroom", pitch: -0.5560939123340298, yaw: 3.3695960144672212, targetNode: "Hall-office" }, 
        { node: "Bathroom", pitch: -0.27350172815662055, yaw: 3.2870263488495346, targetNode: "Hall-smalloffice" }, 
        { node: "Bathroom", pitch: -0.19166782445770703, yaw: 3.2705402352331894, targetNode: "Hall-main" }, 

        { node: "Hall-front", pitch: -0.5792766775199838, yaw: 2.822672700456552, targetNode: "Hall-topstairs2" },
        { node: "Hall-front", pitch: -1.0224823269098997, yaw: 3.3640943588465864, targetNode: "Hall-main" }, 
        { node: "Hall-front", pitch: -0.44484234942852474, yaw: 6.282555001791218, targetNode: "Hall-back" },

        { node: "Back-bedroom-door", pitch: -0.6474478152708754, yaw: 0.5462730492519478, targetNode: "Hall-back-bedroom" },

        { node: "Master-bedroom-hall", pitch: -0.27282591079216445, yaw: 3.229046706114456, targetNode: "Hall-back-bedroom" },
        { node: "Master-bedroom-hall", pitch: -0.8282097686499497, yaw: 3.2197327034174257, targetNode: "Master-hall" },
        
        { node: "Master-ensuite", pitch: -0.6737603781830912, yaw: 5.812698487851656, targetNode: "Master-hall" },

        { node: "Master-hall", pitch: -0.3973807811032961, yaw: 4.7564770840772645, targetNode: "Hall-back-bedroom" },
        { node: "Master-hall", pitch: -0.6268231414790661, yaw: 3.1690680084580642, targetNode: "Master-ensuite" },

        { node: "Hall-back", pitch: -0.6097911641268885, yaw: 0.6980206553387552, targetNode: "Hall-back-bedroom" },
        { node: "Hall-back", pitch: -0.35858537784076683, yaw: 5.285347695116675, targetNode: "Hall-main" },

        { node: "Master-bedroom-front", pitch: -0.30600245110085167, yaw: 0.6453727754752832, targetNode: "Master-hall" },
        { node: "Master-bedroom-front", pitch: -0.27105690316485065, yaw: 0.09212128976813677, targetNode: "Master-bedroom-back" },

        { node: "Master-bedroom-back", pitch: -0.3683157870558662, yaw: 3.5221195725861536, targetNode: "Master-hall" }, 
        { node: "Master-bedroom-back", pitch: -0.18609449785394006, yaw: 3.5719371682677115, targetNode: "Hall-back-bedroom" }, 
        { node: "Master-bedroom-back", pitch: -0.1344356296259246, yaw: 3.605959483751454, targetNode: "Hall-back" },
        { node: "Master-bedroom-back", pitch: -0.25982769843700915, yaw: 5.077342004653624, targetNode: "Master-bedroom-front" }

        ];


        const floorFirst = [
        { id: "Living", image: "images-first/094752.jpg" },
            { id: "Hall-bottom-stairs", image: "images-first/095633.jpg" },
            { id: "Cloakroom", image: "images-first/095544.jpg" },
            { id: "Hall-end", image: "images-first/095510.jpg" },
            { id: "Hall-front", image: "images-first/095419.jpg" },
            { id: "Closet", image: "images-first/095345.jpg" },
            { id: "Entrance", image: "images-first/095255.jpg" },
            { id: "Hall-doors", image: "images-first/095203.jpg" },
            { id: "Living-front", image: "images-first/095138.jpg" },
            { id: "Living-fireplace", image: "images-first/095108.jpg" },
            { id: "Living-piano", image: "images-first/095045.jpg" },
            { id: "Living-middle", image: "images-first/095022.jpg" },
            { id: "Living-back", image: "images-first/094953.jpg" },
            { id: "Living-back-window", image: "images-first/094908.jpg" },
            { id: "Living-patio", image: "images-first/094837.jpg" }
   
        ]
        const floorFirst_hotspots = [
            { node: "Hall-bottom-stairs", pitch: -0.9596557470856717, yaw: 4.800446367779735, targetNode: "Hall-end" },
            
            { node: "Hall-end", pitch: -0.9508320242795558, yaw: 0.11668334479587954, targetNode:  "Hall-bottom-stairs" },
            { node: "Hall-end", pitch: -0.7495866061143679, yaw: 4.720255146991696, targetNode: "Cloakroom" },
            { node: "Hall-end", pitch: -0.4037747644279883, yaw: 1.8538813513079653, targetNode: "Hall-front" },
            { node: "Hall-end", pitch: -0.20290667432892162, yaw: 1.8149208816845301, targetNode: "Living-front" },
            
            { node: "Cloakroom", pitch: -0.8176638425832898, yaw: 2.9918726444403982, targetNode: "Hall-end" },

            { node: "Hall-front", pitch: -0.388333975774249, yaw: 4.814318536665218, targetNode: "Hall-end" },
            { node: "Hall-front", pitch: -0.3228200949032145, yaw: 1.7953623173520696, targetNode: "Living-front" },

            { node: "Entrance", pitch: -0.5582046153463267, yaw: 0.17551408937063026, targetNode: "Hall-front" },

            { node: "Hall-doors", pitch: -0.4876666764413393, yaw: 3.1274364441353617, targetNode: "Living-front" },
            { node: "Hall-doors", pitch: -0.2999505917937595, yaw: 6.2071545635583645, targetNode: "Hall-end" },

            { node: "Living-front", pitch: -0.3875560406275602, yaw: 5.697116514594738, targetNode: "Hall-doors" }, 
            { node: "Living-front", pitch: -0.20750347412258208, yaw: 5.704646756576477, targetNode: "Hall-end" },
            { node: "Living-front", pitch: -0.4248313800469168, yaw: 4.23200496205938, targetNode: "Living-piano" },
            { node: "Living-front", pitch: -0.15053833064841982, yaw: 4.025827403859871, targetNode: "Living-back-window" }, 
            { node: "Living-front", pitch: -0.3338449169446811, yaw: 3.9208502100727727, targetNode: "Living-middle" },

            { node: "Living-piano", pitch: -0.5159603901081016, yaw: 1.675880697034574, targetNode: "Living-fireplace" },
            { node: "Living-piano", pitch: -0.19023872171146672, yaw: 3.568031889966904, targetNode: "Living-back-window" },
            { node: "Living-piano", pitch: -0.5001323624189857, yaw: 0.8802546399298081, targetNode: "Living-front"},
            { node: "Living-piano", pitch: -0.6319148200505245, yaw: 2.8711493734633238, targetNode: "Living-middle" },

            { node: "Living-fireplace", pitch: -0.551683903879419, yaw: 1.379717927607364, targetNode: "Living-piano"},
            { node: "Living-fireplace", pitch: -0.2015398398823982, yaw: 0.45518777967020996, targetNode: "Living-back-window"}, 
            { node: "Living-fireplace", pitch: -0.2027026378510608, yaw: 0.7533477188300528, targetNode:  "Living-patio" }, 
            { node: "Living-fireplace", pitch: -0.4945212218787809, yaw: 0.5633446112309303, targetNode: "Living-middle" },
             
            { node: "Living-patio", pitch: -0.42616576348902147, yaw: 1.115862668275967, targetNode: "Living-back-window" },
            
            { node: "Living-back-window", pitch: -0.443048177497364, yaw: 4.966087682428417, targetNode:  "Living-patio" }, 
            { node: "Living-back-window", pitch: -0.1810351067989775, yaw: 5.938805895073785, targetNode:  "Living-front" }, 

            { node: "Living", pitch: -0.1989305234892096, yaw: 1.4431774115883302, targetNode: "Living-front" }, 
            { node: "Living", pitch: -0.2179847440325, yaw: 1.707252041041275, targetNode: "Living-fireplace" },
            { node: "Living", pitch: -0.6506718965374385, yaw: 6.268025371337689, targetNode: "Living-patio"},
            { node: "Living", pitch: -0.6063948510819785, yaw: 3.9626883050497304, targetNode: "Living-back-window" },

            { node: "Living-middle", pitch: -0.5498757913957246, yaw: 2.062677926668701, targetNode: "Living-fireplace" }, 
            { node: "Living-middle", pitch: -0.6652254266460553, yaw: 0.861955388884631, targetNode: "Living-piano" },
            { node: "Living-middle", pitch: -0.24456270041188777, yaw: 4.918854248876823, targetNode: "Living-back-window" },
            { node: "Living-middle", pitch: -0.2997137261088372, yaw: 5.515250938388093, targetNode: "Living-patio" },
            { node: "Living-back", pitch: -0.5203998699541099, yaw: 0.23287755818600306, targetNode: "Living-middle"},
            { node: "Living-middle", pitch: -0.38202725430674267, yaw: 1.5136798611052864, targetNode:  "Living-front" } 
            
        ]

        const floorGarden = [
            { id: "Greenhouse", image: "images-garden/163236.jpg" },
            { id: "Wood-bench", image: "images-garden/163154.jpg" },
            { id: "Step", image: "images-garden/163127.jpg" },
            { id: "Bluebucket", image: "images-garden/163053.jpg" },
            { id: "Garage", image: "images-garden/163014.jpg" },
            { id: "View-6", image: "images-garden/162946.jpg" },
            { id: "Hose", image: "images-garden/162920.jpg" },
            { id: "Living-room", image: "images-garden/162857.jpg" },
            { id: "View-9", image: "images-garden/162836.jpg" },
            { id: "Bird-feeder", image: "images-garden/162800.jpg" },
            { id: "Trellis", image: "images-garden/162736.jpg" },
            { id: "Rotary", image: "images-garden/162701.jpg" },
            { id: "Planters", image: "images-garden/162633.jpg" },
            { id: "Backdoor", image: "images-garden/162603.jpg" },
            { id: "Patio-window", image: "images-garden/162430.jpg" }
        ];

        const floorGarden_hotspots = [
            { node: "Greenhouse", pitch: -0.07713795834857917, yaw: 6.183194912236688, targetNode: "Bluebucket" },
            { node: "Greenhouse", pitch: -0.23410251958825024, yaw: 6.073722411655052, targetNode: "Step" }, 
            { node: "Greenhouse", pitch: -0.504418919723669, yaw: 6.082925334913266, targetNode: "Wood-bench" },

            { node: "Wood-bench", pitch: -0.6610913622984724, yaw: 3.2496377372488374, targetNode: "Greenhouse" }, 
            { node: "Wood-bench", pitch: -0.4142994585135511, yaw: 0.002526456368286156, targetNode: "Step" },

            { node: "Step", pitch: -0.3234730233108327, yaw: 3.479251153556481, targetNode: "Greenhouse" }, 
            { node: "Step", pitch: -0.11309316374504808, yaw: 0.5805833423709842, targetNode: "Garage" }, 
            { node: "Step", pitch: -0.12788661480946795, yaw: 0.3152656429533759, targetNode: "Hose" },
            { node: "Step", pitch: -0.1295788967278968, yaw: 0.028842724339816002, targetNode: "Living-room" },

            { node: "Garage", pitch: -0.2597983372010435, yaw: 5.04037219445135, targetNode: "Living-room" },
            { node: "Garage", pitch: -0.13431262688905488, yaw: 4.802666867451025, targetNode: "Trellis" },
            { node: "Garage", pitch: -0.32536261872124284, yaw: 3.6378496595852337, targetNode: "Bluebucket" },

            { node: "Bluebucket", pitch: -0.2560914016649931, yaw: 2.7956086735177155, targetNode: "Greenhouse" },
            { node: "Bluebucket", pitch: -0.19774398629108791, yaw: 5.0634961938520675, targetNode: "Living-room" },
            { node: "Bluebucket", pitch: -0.2542457373258751, yaw: 5.957003656232384, targetNode: "Garage" },

            { node: "Hose", pitch: -0.3160344130340551, yaw: 3.0174337452486593, targetNode: "Bluebucket" }, 
            { node: "Hose", pitch: -0.19881300097018872, yaw: 3.2668017734459642, targetNode: "Greenhouse" },
            
            { node: "Living-room", pitch: -0.22262820722970256, yaw: 2.273258577393064, targetNode: "Bluebucket" },
            { node: "Living-room", pitch: -0.3447007242687419, yaw: 4.050485001823768, targetNode: "Bird-feeder" },
            { node: "Living-room", pitch: -0.25131689321003403, yaw: 4.229684623910908, targetNode: "Trellis" },
            { node: "Living-room", pitch: -0.18782154978616772, yaw: 4.372387521557695, targetNode: "Planters" },
            { node: "Living-room", pitch: -0.2624044132985719, yaw: 1.3586437002876413, targetNode: "Garage" },
            
            { node: "Bird-feeder", pitch: -0.509576670686319, yaw: 3.882216357567855, targetNode: "Trellis" }, 
            { node: "Bird-feeder", pitch: -0.4006993926178457, yaw: 0.47752243863542315, targetNode: "Living-room" }, 
            { node: "Bird-feeder", pitch: -0.15190977094493108, yaw: 0.6783090309956358, targetNode: "Garage" },
            { node: "Bird-feeder", pitch: -0.1608873840167997, yaw: 1.2912570942419062, targetNode: "Bluebucket" },
            { node: "Bird-feeder", pitch: -0.21462812646597795, yaw: 4.60684039495985, targetNode: "Backdoor" },
            { node: "Bird-feeder", pitch: -0.2624520995463433, yaw: 4.005420541414464, targetNode: "Planters" },
            { node: "Bird-feeder", pitch: -0.2795213510787382, yaw: 5.33925839783045, targetNode: "Patio-window" },

            { node: "Trellis", pitch: -0.28694063527568825, yaw: 5.759495723722672, targetNode:  "Backdoor" },
            { node: "Trellis", pitch: -0.24153992098087218, yaw: 1.2715295591893983, targetNode: "Living-room" },
            { node: "Trellis", pitch: -0.5172862984125866, yaw: 4.815560704999929, targetNode: "Planters" },
            { node: "Trellis", pitch: -0.13152104969727163, yaw: 1.381863202002466, targetNode: "Garage" },
            { node: "Trellis", pitch: -0.2513102153195561, yaw: 0.24929868093338411, targetNode: "Patio-window" },
            
            { node: "Planters", pitch: -0.32467774543649286, yaw: 0.26686814096817285, targetNode:  "Backdoor" },
            { node: "Planters", pitch: -0.49912895620887854, yaw: 2.1431069405111827, targetNode: "Trellis" },
            { node: "Planters", pitch: -0.13210479576633105, yaw: 1.7117211384273108, targetNode: "Living-room" }, 
            { node: "Planters", pitch: -0.21749853556859566, yaw: 0.9523681518807604, targetNode: "Patio-window" },

            { node:  "Backdoor", pitch: -0.2616487693661571, yaw: 2.857490839995216, targetNode: "Trellis" },
            { node:  "Backdoor", pitch: -0.2999541869031117, yaw: 1.5304611703512239, targetNode: "Patio-window" },
            { node:  "Backdoor", pitch: -0.3510334090097589, yaw: 3.3307136938124353, targetNode: "Planters" },

            { node: "Patio-window", pitch: -0.2802068528591457, yaw: 3.2358625986183562, targetNode: "Bird-feeder" }, 
            { node: "Patio-window", pitch: -0.2638147881380226, yaw: 3.758631343211357, targetNode: "Trellis" },
            { node: "Patio-window", pitch: -0.32565581016068057, yaw: 4.801329961454193, targetNode:  "Backdoor" },
            { node: "Patio-window", pitch: -0.25539266800585114, yaw: 4.119284893421629, targetNode: "Planters" }
        ];


        // Create image Nodes    
        var nodeGarden = [];
        floorGarden.forEach(location => {
            const n = getNode3(location.id, location.image)
            nodeGarden.push( n);
        });
        var nodeFirst = []
        floorFirst.forEach(location => {
            const n = getNode3(location.id, location.image)
            nodeFirst.push( n);
        });
        var nodeSecond = []
        floorSecond.forEach(location => {
            const n = getNode3(location.id, location.image)
            nodeSecond.push( n);
        });


        const viewer = new Viewer({
            container: document.querySelector('#viewer'),
            panorama: `image1.jpg`,
            caption: pageCaption,

            plugins: [
                [MarkersPlugin, {} ],
                [GalleryPlugin, {}],
                [CompassPlugin, {
                    hotspots: [
                        { yaw: '0deg' },
                        { yaw: '90deg' },
                        { yaw: '180deg' },
                        { yaw: '270deg' },
                    ],
                }],

                [VirtualTourPlugin, {
                    positionMode: 'gps',
                    renderMode: '3d',
                    nodes: nodeGarden,
                    startNodeId: "Greenhouse",
                }]
            ],
        });

        var floorHotspots = floorGarden_hotspots;

        const markersPlugin = viewer.getPlugin(MarkersPlugin);
        const virtualTourPlugin = viewer.getPlugin(VirtualTourPlugin);

        virtualTourPlugin.addEventListener('node-changed', ({ node }) => {
            // Clear existing markers
            markersPlugin.clearMarkers();

            // Add markers from floorHotspots
            floorHotspots.forEach(hotspot => {
                if (hotspot.node === node.id) {
                    markersPlugin.addMarker({
                        id: '#' + Math.random(),
                        position: { yaw: hotspot.yaw, pitch: hotspot.pitch },
                        image: baseUrl + 'pictos/pin-blue.png',
                        //image: baseUrl + 'pictos/target.png',
                        size: { width: 64, height: 64 },
                        anchor: 'center center',
                        tooltip: `${hotspot.targetNode}`,
                        data: {
                            generated: true,
                            targetNode: hotspot.targetNode,
                        },
                    });
                }
            });
        });


        /**
         * Create a new marker when the user clicks somewhere
         */
        viewer.addEventListener('click', ({ data }) => {
            if (isEditingMode && !data.rightclick) {
                const s = `${data.yaw} ${data.pitch}`
                const newMarker = {
                    id: '#' + Math.random(),
                    position: { yaw: data.yaw, pitch: data.pitch },
                    image: baseUrl + 'pictos/pin-red.png',
                    size: { width: 32, height: 32 },
                    anchor: 'bottom center',
                    tooltip: s,
                    data: {
                        generated: true,
                    }
                };

                markersPlugin.addMarker( newMarker);
                
                // Update the editSummary text input with marker information
                const currentNode = virtualTourPlugin.getCurrentNode();

                const editSummary = document.getElementById('editSummary');
                editSummary.value = `{ node: \"${currentNode.id}\", pitch: ${newMarker.position.pitch}, yaw: ${newMarker.position.yaw}, targetNode: 1 },`;
            }

            /**
             * Delete a generated marker when the user double-clicks on it
             * Or change the image if the user right-clicks on it
             */
            markersPlugin.addEventListener('select-marker', ({ marker, click, doubleClick, rightClick }) => {
                if (marker.data?.generated) {
                    if (isEditingMode && doubleClick) {
                        markersPlugin.removeMarker(marker);
                    } else if (isEditingMode && rightClick) {
                        markersPlugin.updateMarker({
                            id: marker.id,
                            image: baseUrl + 'pictos/pin-blue.png',
                        });
                        const currentNode = virtualTourPlugin.getCurrentNode();
                        console.log( currentNode.id, marker.config.position.yaw, marker)
                    }
                }
                if( !isEditingMode && click ) {
                    console.log( "Navigate:" + marker.id + " -> " + marker.data.targetNode );
                    if ( marker.data.targetNode ) {
                        virtualTourPlugin.setCurrentNode( marker.data.targetNode );
                    }
                }
                if( !isEditingMode && doubleClick ) {
                    console.log( "Navigate:" + marker.id + " -> " + marker.data.targetNode );
                    if ( marker.data.targetNode ) {
                        virtualTourPlugin.setCurrentNode( marker.data.targetNode );
                    }
                }
                if( !isEditingMode && rightClick ) {
                    if ( marker.data.targetNode ) {
                        virtualTourPlugin.setCurrentNode( marker.data.targetNode );
                    }
                }
            });


        });


        viewer.addEventListener('click', ({ data }) => {
            console.log(`${data.rightclick ? 'right ' : ''}clicked at yaw: ${data.yaw} pitch: ${data.pitch}`);
            // Log the pan value from sphereCorrection
            nodeGarden.forEach(node => {
                console.log(`Node ${node.id} pan: ${node.sphereCorrection.pan} roll: ${node.roll}`);
     
            });

        });
        

        viewer.addEventListener('position-updated', ({ position }) => {
            //console.log(`new yaw: ${position.yaw} pitch: ${position.pitch} x ${position.offsetX} y ${position.offsetY}` );
        });
        

    // Add event listener to export button
    document.getElementById('exportButton').addEventListener('click', () => {
        //const json = JSON.stringify(floorGarden, null, 2);
        const json = JSON.stringify(floorGarden );
        console.log(json);
    });

    // Add event listener to export button
    document.getElementById('exportHotspots').addEventListener('click', () => {
        const currentNode = virtualTourPlugin.getCurrentNode();
        const ms = markersPlugin.getMarkers();
        var index = 1
        ms.forEach( m => {
            console.log(`{ node: \"${currentNode.id}\", pitch: ${m.config.position.pitch}, yaw: ${m.config.position.yaw}, targetNode: 1 },`);
            index += 1;
        });
    });

    let isEditingMode = false;

    // Add event listener to the checkbox
    document.getElementById('editMode').addEventListener('change', (event) => {
        isEditingMode = event.target.checked;
    });

    
    // Switch the set of images being displayed and the set of hotspots
    document.getElementById('viewFirst').addEventListener('click', () => {
        if( nodeFirst.length > 0 ) {
            floorHotspots = floorFirst_hotspots;
            virtualTourPlugin.setNodes( nodeFirst );
        }
    });
    document.getElementById('viewSecond').addEventListener('click', () => {
        if( nodeSecond.length > 0 ) {
            floorHotspots = floorSecond_hotspots;
            virtualTourPlugin.setNodes( nodeSecond );
        }
    });
    document.getElementById('viewGarden').addEventListener('click', () => {

        if( nodeFirst.length > 0 ) {
            floorHotspots = floorGarden_hotspots;
            virtualTourPlugin.setNodes( nodeGarden );
            
        }
    });


    </script>


<div>
 <button id="viewGarden" class="ios-button">VIEW Garden</button>
   <button id="viewFirst" class="ios-button">VIEW First Floor</button>
   <button id="viewSecond" class="ios-button">VIEW Second Floor</button>
</div>
    

<!-- Export button 
 -->
<button id="exportButton">Export dynNode as JSON</button>
<button id="exportHotspots">Export hotSpots</button>
<label for="editMode">edit mode</label>
<input type="checkbox" id="editMode">
<input type="text" id="editSummary" style="width:800px" value="">
<br>


</body>
</html>
